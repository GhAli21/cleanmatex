---
alwaysApply: true
---

# Next.js Frontend Standards (Aligned with Architecture)

This document defines the **frontend standards** for CleanMateX and is fully aligned with the architecture described in `AI_Coder_Frontend_Instructions.md`.

**Always use Global Message Utility (`cmxMessage`) for showing all and any messages, errors, alerts ... so on**

- Use CmxEditableDataTable reusable ui component for editable data tables : reference developer guide in docs/dev/cmx-editable-datatable/developer_guide.md

Authoritative folder structure:

```txt
app/            # Next.js App Router (routing only)
src/
  ui/           # Global Cmx Design System (reusable UI components)
  features/     # Feature modules (domain-specific UI + logic)
lib/            # Shared infrastructure (API clients, hooks, utils, config)
```

Path aliases (tsconfig):

```jsonc
{
  "compilerOptions": {
    "baseUrl": ".",
    "paths": {
      "@ui/*": ["src/ui/*"],
      "@features/*": ["src/features/*"],
      "@lib/*": ["lib/*"]
    }
  }
}
```

All standards below MUST respect this structure.

---

## 1. Tech Stack & Core Principles

- **Framework:** Next.js (App Router)
- **Language:** TypeScript only (no plain JS for app code)
- **Styling:** Tailwind CSS, design tokens, CSS variables
- **UI Layer:**
  - shadcn/ui (wrapped only in Cmx components)
  - Cmx Design System in `src/ui`
- **State / Data:**
  - React Query (TanStack Query) for async data
  - React Hook Form + Zod for forms & validation
- **API:**
  - Centralized API client in `lib/api`
- **Types:**
  - Supabase generated types for DB entities
  - Shared domain types in `src/features/*/model` or `lib/types`

Guiding principles:

- Composition over inheritance.
- Small, focused components.
- Strong typing everywhere.
- Clear separation of concerns between routing, domain logic, and UI.

---

## 2. Folder Responsibilities

### 2.1 `app/` – Routing Layer

- Contains:
  - `page.tsx`, `layout.tsx`, `loading.tsx`, `error.tsx`, route groups.
- Responsibilities:
  - Defines routes and top-level layout structure.
  - Composes screens from `src/features` and `src/ui`.
- MUST NOT:
  - Define reusable primitives.
  - Contain design system components.
  - Contain domain logic.

Example:

```tsx
// app/dashboard/orders/page.tsx
import { OrderListScreen } from "@features/orders/ui/order-list-screen";

export default async function OrdersPage() {
  return <OrderListScreen />;
}
```

---

### 2.2 `src/ui/` – Global Cmx Design System

- Location of all **reusable, app-wide UI components**.
- All components here MUST:
  - Use the `Cmx` prefix (e.g., `CmxButton`, `CmxEditableDataTable`, `CmxDataTable`, `CmxPageHeader`).
  - Be generic and not tied to a specific business domain.
  - Be theme-aware (colors, radius, density, dark mode).
- Subfolders (recommended):

```txt
src/ui/
  foundations/
  primitives/
  data-display/
  forms/
  navigation/
  layouts/
  patterns/
  charts/
  feedback/
  overlays/
```

Rules:

- MUST NOT import from `app/` or `src/features/`.
- MAY import from `lib/` for infra/utilities.
- All shadcn/ui components MUST be wrapped as Cmx components here; features should not import shadcn directly.

Example:

```tsx
// src/ui/primitives/cmx-button.tsx
export function CmxButton(/* props */) {
  // Wrap shadcn/ui or base <button>, apply Tailwind + tokens
}
```

---

### 2.3 `src/features/` – Feature Modules

Each feature/module lives under `src/features/<featureName>/`:

```txt
src/features/orders/
  ui/
  api/
  hooks/
  model/
```

- `ui/`: Screens and UI components specific to the feature.
- `api/`: Feature-scoped API client functions.
- `hooks/`: Domain-specific React hooks.
- `model/`: Types, mappers, domain models.

Rules:

- Feature UI must compose from `src/ui` (Cmx components) and `lib`.
- Feature UI MUST NOT import from other features’ folders directly.
- Feature UI MUST NOT import from `app/`.

Example:

```tsx
// src/features/orders/ui/order-list-screen.tsx
import { CmxDataTable } from "@ui/data-display/cmx-datatable";
import { useOrders } from "../hooks/use-orders";

export function OrderListScreen() {
  const { data, isLoading } = useOrders();
  return (
    <CmxDataTable
      data={data ?? []}
      loading={isLoading}
      /* ... */
    />
  );
}
```

---

### 2.4 `lib/` – Shared Infrastructure (Root-Level)

- Lives at project root: `lib/`
- Contains:
  - `lib/api/` – base API client(s)
  - `lib/hooks/` – generic cross-feature hooks
  - `lib/utils/` – generic utilities
  - `lib/config/` – configuration helpers
  - `lib/supabase/` – Supabase client, if used

Rules:

- Can be imported by `app/`, `src/ui`, and `src/features`.
- Must not depend on `src/ui` or `src/features`.

---

## 3. UI Standards

### 3.1 Cmx Components (Design System)

- All reusable UI must be implemented as **Cmx** components in `src/ui`.
- Naming:
  - `CmxButton`, `CmxInput`, `CmxCard`, `CmxDataTable`, `CmxForm`, `CmxPageHeader`, etc.

Usage rules:

- Features should **only** use Cmx components (not shadcn directly).
- If a new primitive is needed:
  - Implement it once in `src/ui/primitives/` (wrapping shadcn or native HTML).
  - Use it everywhere via `@ui/...`.

Example import:

```ts
import { CmxButton } from "@ui/primitives/cmx-button";
```

### 3.2 Styling & Tailwind

- Use Tailwind for:
  - Layout: flex, grid, gap, margin, padding.
  - Typography scale: `text-sm`, `text-base`, `text-lg`.
  - Responsiveness: `sm:`, `md:`, `lg:`, `xl:` breakpoints.
- Do NOT hardcode brand colors in components:
  - Avoid `text-blue-500`, `bg-green-500`, hex literals.
- Use theme tokens and CSS variables:
  - `text-[rgb(var(--cmx-foreground-rgb))]`
  - `bg-[rgb(var(--cmx-surface-rgb))]`
  - etc.

### 3.3 Icons (Lucide)

- Use `lucide-react` for icons.
- Wrap common icon patterns into Cmx components where it makes sense (e.g. `CmxIconButton`).

### 3.4 Toasts (Sonner)

- Use Sonner (wired once at app root).
- Expose wrapper helpers if needed in `src/ui/feedback/` for consistent variants.

---

## 4. Forms & Validation

### 4.1 React Hook Form + Zod

- All non-trivial forms must use:
  - **React Hook Form** for state and submission.
  - **Zod** for schema validation.

Pattern:

```tsx
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";

// Define schema
const FormSchema = z.object({
  name: z.string().min(1),
});

// Infer TypeScript type
type FormValues = z.infer<typeof FormSchema>;

export function SomeForm() {
  const form = useForm<FormValues>({
    resolver: zodResolver(FormSchema),
    defaultValues: { name: "" },
  });

  return (
    <form onSubmit={form.handleSubmit(onSubmit)}>
      {/* use CmxForm + CmxInput here */}
    </form>
  );
}
```

- Zod schemas should live near where they are used:
  - For feature forms: under `src/features/<feature>/ui` or `model` if shared.
  - For shared schemas: `lib/types` or `lib/validation`.

---

## 5. API Client & Data Fetching

### 5.1 Central API Client (`lib/api`)

- There should be a single reusable API client abstraction, e.g.:

```ts
// lib/api/client.ts
export async function apiRequest<T>(
  input: RequestInfo,
  init?: RequestInit
): Promise<T> {
  // handle base URL, auth headers, error handling, etc.
}
```

- Feature-specific API functions should live under `src/features/<feature>/api`, and call `apiRequest`.

Example:

```ts
// src/features/orders/api/orders-api.ts
import { apiRequest } from "@lib/api/client";

export async function fetchOrders(params: { page: number }) {
  return apiRequest<{ data: Order[]; total: number }>(
    `/api/orders?page=${params.page}`
  );
}
```

### 5.2 React Query (TanStack Query)

- Use React Query for server data caching and fetching.
- Feature hooks should wrap query logic:

```ts
// src/features/orders/hooks/use-orders.ts
import { useQuery } from "@tanstack/react-query";
import { fetchOrders } from "../api/orders-api";

export function useOrders(params: { page: number }) {
  return useQuery({
    queryKey: ["orders", params],
    queryFn: () => fetchOrders(params),
  });
}
```

---

## 6. Supabase Types Usage

- Supabase-generated types must be used as **base DB shapes**, not directly as UI models.
- Mapping rules:
  - Raw types from Supabase: used in `lib` or `src/features/*/model`.
  - Map DB types to UI/domain types in a separate mapper function.

Example pattern:

```ts
// lib/types/supabase.ts
export type DbOrder = {
  /* generated */
};

// src/features/orders/model/order-types.ts
export type Order = {
  id: string;
  customerName: string;
  // ...
};

export function mapDbOrderToOrder(db: DbOrder): Order {
  return {
    id: db.id,
    customerName: db.customer_name ?? "",
    // ...
  };
}
```

---

## 7. Tables, Charts, and Analytics

### 7.1 TanStack Table

- Use TanStack Table for complex data tables.
- Wrap table patterns in Cmx components under `src/ui/data-display/`:
  - `CmxDataTable`
  - `CmxSortableTable`
  - etc.

Feature tables should **compose** from these wrappers, not build TanStack logic from scratch each time.

### 7.2 Recharts

- Use Recharts for charts.
- Wrap chart patterns in `src/ui/charts/`:
  - `CmxLineChart`
  - `CmxBarChart`
  - `CmxDonutChart`

Screens in `src/features` should use these Cmx chart components.

---

## 8. Error Handling & UX

- **Always** use Global Message Utility (`cmxMessage`) for showing all and any messages, errors, alerts ... so on
  Global Message Utility (`cmxMessage`) README and usage guide is: /src/ui/feedback/cmxMessage_developer_guide.md
  Global Message Utility (`cmxMessage`) MIGRATION guide is: /src/ui/feedback/cmxMessage_MIGRATION.md

- Handle errors at three levels:
  1. API error handling in `apiRequest` (HTTP status, network errors).
  2. React Query error boundaries where appropriate.
  3. User-facing toasts (Sonner) or inline messages (Cmx components in `src/ui/feedback/`).

Patterns:

- For forms: show validation errors near fields using Cmx form components.
- For lists/tables: show empty/error states with `CmxEmptyState`.

---

## 9. Linting, Formatting, and DX

- Use ESLint with:
  - Typescript rules
  - React + React Hooks rules
  - Architecture constraints for `app/`, `src/ui/`, `src/features/`, `lib/`.
- Use Prettier for formatting.
- Enable Tailwind IntelliSense for class name completion.
- No `console.log` in committed code (use proper logging or dev-only `debug` helpers).

---

## 10. Quick Rules Checklist

- **Routing:** Only in `app/`.
- **Reusable UI:** Only in `src/ui`, named with `Cmx*`.
- **Feature UI and logic:** In `src/features/<feature>/...`.
- **Infra & utilities:** In `lib/`.
- **Imports:**
  - `@ui/*` → `src/ui/*`
  - `@features/*` → `src/features/*`
  - `@lib/*` → `lib/*`
- **Do not use:** `components/ui`, `shared/`, `common/` as roots.
- **Pagination Always should be Server-Side Pagination (API-Driven)**

This document is the single source of truth for frontend implementation standards and must always remain consistent with the architecture defined in `AI_Coder_Frontend_Instructions.md`.
