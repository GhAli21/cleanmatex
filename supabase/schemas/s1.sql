
supabase db dump --schema-only -f "cleanmatex_schema_$timestamp.sql"
supabase db dump --schema-only --project-ref $projectRef --db-url $dbUrl > "cleanmatex_schema_$timestamp.sql"
-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.org_branches_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  branch_name text,
  s_date timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  phone character varying,
  email character varying,
  type character varying DEFAULT 'walk_in'::character varying,
  address text,
  country text,
  city text,
  area text,
  street text,
  building text,
  floor text,
  latitude double precision,
  longitude double precision,
  rec_order integer,
  rec_status smallint DEFAULT 1,
  is_active boolean NOT NULL DEFAULT true,
  rec_notes character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  CONSTRAINT org_branches_mst_pkey PRIMARY KEY (tenant_org_id, id),
  CONSTRAINT fk_org_branch_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_customer_addresses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_id uuid NOT NULL,
  tenant_org_id uuid NOT NULL,
  address_type character varying DEFAULT 'home'::character varying,
  label character varying,
  building character varying,
  floor character varying,
  apartment character varying,
  street character varying,
  area character varying,
  city character varying,
  country character varying DEFAULT 'OM'::character varying,
  postal_code character varying,
  latitude numeric,
  longitude numeric,
  is_default boolean DEFAULT false,
  delivery_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_by character varying,
  is_active boolean DEFAULT true,
  CONSTRAINT org_customer_addresses_pkey PRIMARY KEY (id),
  CONSTRAINT fk_address_customer FOREIGN KEY (customer_id) REFERENCES public.org_customers_mst(id),
  CONSTRAINT fk_address_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_customer_merge_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  source_customer_id uuid NOT NULL,
  target_customer_id uuid NOT NULL,
  merged_by uuid NOT NULL,
  merge_reason text,
  orders_moved integer DEFAULT 0,
  loyalty_points_merged integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT org_customer_merge_log_pkey PRIMARY KEY (id),
  CONSTRAINT org_customer_merge_log_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_customers_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  customer_id uuid,
  name text,
  name2 text,
  display_name text,
  first_name text,
  last_name text,
  phone text,
  email text,
  type text DEFAULT 'walk_in'::text,
  address text,
  area text,
  building text,
  floor text,
  preferences jsonb DEFAULT '{}'::jsonb,
  customer_source_type text NOT NULL DEFAULT 'DIRECT'::text,
  s_date timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  loyalty_points integer DEFAULT 0,
  rec_order integer,
  rec_status smallint DEFAULT '1'::smallint,
  is_active boolean NOT NULL DEFAULT true,
  rec_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by uuid,
  created_info text,
  updated_at timestamp without time zone,
  updated_by uuid,
  updated_info text,
  CONSTRAINT org_customers_mst_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_cust_sys FOREIGN KEY (customer_id) REFERENCES public.sys_customers_mst(id),
  CONSTRAINT fk_org_cust_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_discount_rules_cf (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  rule_code character varying NOT NULL,
  rule_name character varying NOT NULL,
  rule_name2 character varying,
  description text,
  description2 text,
  rule_type character varying NOT NULL CHECK (rule_type::text = ANY (ARRAY['bulk_discount'::character varying, 'category_discount'::character varying, 'customer_tier'::character varying, 'seasonal'::character varying, 'first_order'::character varying, 'loyalty'::character varying]::text[])),
  discount_type character varying NOT NULL CHECK (discount_type::text = ANY (ARRAY['percentage'::character varying, 'fixed_amount'::character varying]::text[])),
  discount_value numeric NOT NULL CHECK (discount_value > 0::numeric),
  conditions jsonb NOT NULL,
  priority integer DEFAULT 0,
  can_stack_with_promo boolean DEFAULT false,
  can_stack_with_other_rules boolean DEFAULT false,
  valid_from timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  valid_to timestamp with time zone,
  is_active boolean NOT NULL DEFAULT true,
  is_enabled boolean NOT NULL DEFAULT true,
  metadata jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp with time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  rec_order integer,
  rec_notes character varying,
  CONSTRAINT org_discount_rules_cf_pkey PRIMARY KEY (id),
  CONSTRAINT org_discount_rules_tenant_fk FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_gift_card_transactions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  gift_card_id uuid NOT NULL,
  transaction_type character varying NOT NULL CHECK (transaction_type::text = ANY (ARRAY['redemption'::character varying, 'refund'::character varying, 'adjustment'::character varying, 'cancellation'::character varying]::text[])),
  amount numeric NOT NULL,
  balance_before numeric NOT NULL,
  balance_after numeric NOT NULL,
  order_id uuid,
  invoice_id uuid,
  notes text,
  transaction_date timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  processed_by character varying,
  metadata jsonb,
  CONSTRAINT org_gift_card_transactions_pkey PRIMARY KEY (id),
  CONSTRAINT org_gift_card_trans_tenant_fk FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT org_gift_card_trans_card_fk FOREIGN KEY (gift_card_id) REFERENCES public.org_gift_cards_mst(id)
);
CREATE TABLE public.org_gift_cards_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  card_number character varying NOT NULL UNIQUE,
  card_pin character varying,
  card_name character varying,
  card_name2 character varying,
  original_amount numeric NOT NULL CHECK (original_amount > 0::numeric),
  current_balance numeric NOT NULL CHECK (current_balance >= 0::numeric),
  issued_date timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  expiry_date timestamp with time zone,
  issued_to_customer_id uuid,
  status character varying NOT NULL DEFAULT 'active'::character varying CHECK (status::text = ANY (ARRAY['active'::character varying, 'used'::character varying, 'expired'::character varying, 'cancelled'::character varying, 'suspended'::character varying]::text[])),
  is_active boolean NOT NULL DEFAULT true,
  metadata jsonb,
  rec_notes character varying,
  created_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp with time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  rec_order integer,
  CONSTRAINT org_gift_cards_mst_pkey PRIMARY KEY (id),
  CONSTRAINT org_gift_cards_tenant_fk FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_invoice_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid,
  tenant_org_id uuid NOT NULL,
  invoice_no text NOT NULL,
  subtotal numeric DEFAULT 0,
  discount numeric DEFAULT 0,
  tax numeric DEFAULT 0,
  total numeric DEFAULT 0,
  status text DEFAULT 'pending'::text,
  due_date date,
  payment_method character varying,
  paid_amount numeric DEFAULT 0,
  paid_at timestamp without time zone,
  paid_by character varying,
  metadata jsonb,
  rec_notes character varying,
  created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  CONSTRAINT org_invoice_mst_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_invoice_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_org_invoice_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_order_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  order_id uuid NOT NULL,
  action_type text NOT NULL CHECK (action_type = ANY (ARRAY['ORDER_CREATED'::text, 'STATUS_CHANGE'::text, 'FIELD_UPDATE'::text, 'SPLIT'::text, 'QA_DECISION'::text, 'ITEM_STEP'::text, 'ISSUE_CREATED'::text, 'ISSUE_SOLVED'::text])),
  from_value text,
  to_value text,
  payload jsonb DEFAULT '{}'::jsonb,
  done_by uuid,
  done_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT org_order_history_pkey PRIMARY KEY (id),
  CONSTRAINT fk_history_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_history_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_history_user FOREIGN KEY (done_by) REFERENCES auth.users(id)
);
CREATE TABLE public.org_order_item_issues (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  order_id uuid NOT NULL,
  order_item_id uuid NOT NULL,
  issue_code text NOT NULL CHECK (issue_code = ANY (ARRAY['damage'::text, 'stain'::text, 'complaint'::text, 'other'::text])),
  issue_text text NOT NULL,
  photo_url text,
  priority text DEFAULT 'normal'::text CHECK (priority = ANY (ARRAY['low'::text, 'normal'::text, 'high'::text, 'urgent'::text])),
  created_by uuid,
  created_at timestamp with time zone DEFAULT now(),
  solved_at timestamp with time zone,
  solved_by uuid,
  solved_notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT org_order_item_issues_pkey PRIMARY KEY (id),
  CONSTRAINT fk_issue_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_issue_order_item FOREIGN KEY (order_item_id) REFERENCES public.org_order_items_dtl(id),
  CONSTRAINT fk_issue_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_issue_created_by FOREIGN KEY (created_by) REFERENCES auth.users(id),
  CONSTRAINT fk_issue_solved_by FOREIGN KEY (solved_by) REFERENCES auth.users(id)
);
CREATE TABLE public.org_order_item_processing_steps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  order_id uuid NOT NULL,
  order_item_id uuid NOT NULL,
  step_code text NOT NULL CHECK (step_code = ANY (ARRAY['sorting'::text, 'pretreatment'::text, 'washing'::text, 'drying'::text, 'finishing'::text])),
  step_seq integer NOT NULL CHECK (step_seq >= 1 AND step_seq <= 5),
  done_by uuid,
  done_at timestamp with time zone DEFAULT now(),
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT org_order_item_processing_steps_pkey PRIMARY KEY (id),
  CONSTRAINT fk_step_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_step_order_item FOREIGN KEY (order_item_id) REFERENCES public.org_order_items_dtl(id),
  CONSTRAINT fk_step_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_step_done_by FOREIGN KEY (done_by) REFERENCES auth.users(id)
);
CREATE TABLE public.org_order_items_dtl (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  tenant_org_id uuid NOT NULL,
  service_category_code character varying,
  order_item_srno text,
  product_id uuid,
  barcode text,
  quantity integer DEFAULT 1,
  price_per_unit numeric NOT NULL,
  total_price numeric NOT NULL,
  status text DEFAULT 'pending'::text,
  notes text,
  color character varying,
  brand character varying,
  has_stain boolean,
  has_damage boolean,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  product_name character varying,
  product_name2 character varying,
  stain_notes text,
  damage_notes text,
  item_status text,
  item_stage text,
  item_is_rejected boolean DEFAULT false,
  item_issue_id uuid,
  item_last_step text,
  item_last_step_at timestamp with time zone,
  item_last_step_by uuid,
  quantity_ready integer DEFAULT 0,
  CONSTRAINT org_order_items_dtl_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_items_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_org_items_prod FOREIGN KEY (product_id) REFERENCES public.org_product_data_mst(id),
  CONSTRAINT fk_org_items_ctg FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_org_items_ctg FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_org_items_ctg FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(service_category_code),
  CONSTRAINT fk_org_items_ctg FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(service_category_code)
);
CREATE TABLE public.org_order_status_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  tenant_org_id uuid NOT NULL,
  from_status character varying,
  to_status character varying NOT NULL,
  changed_by uuid,
  changed_by_name character varying,
  changed_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  notes text,
  metadata jsonb DEFAULT '{}'::jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT org_order_status_history_pkey PRIMARY KEY (id),
  CONSTRAINT fk_status_history_order FOREIGN KEY (order_id) REFERENCES public.org_orders_mst(id),
  CONSTRAINT fk_status_history_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_status_history_user FOREIGN KEY (changed_by) REFERENCES auth.users(id)
);
CREATE TABLE public.org_orders_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  branch_id uuid,
  customer_id uuid NOT NULL,
  order_type_id character varying,
  order_no character varying NOT NULL,
  status text DEFAULT 'intake'::text,
  priority text DEFAULT 'normal'::text,
  total_items integer DEFAULT 0,
  subtotal numeric DEFAULT 0,
  discount numeric DEFAULT 0,
  tax numeric DEFAULT 0,
  total numeric DEFAULT 0,
  payment_status character varying DEFAULT 'pending'::character varying,
  payment_method character varying,
  paid_amount numeric DEFAULT 0,
  paid_at timestamp without time zone,
  paid_by character varying,
  payment_notes text,
  received_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  ready_by timestamp without time zone,
  ready_at timestamp without time zone,
  delivered_at timestamp without time zone,
  customer_notes text,
  internal_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  preparation_status character varying DEFAULT 'pending'::character varying,
  prepared_at timestamp without time zone,
  prepared_by uuid,
  ready_by_override timestamp without time zone,
  priority_multiplier numeric DEFAULT 1.0 CHECK (priority_multiplier >= 0.1 AND priority_multiplier <= 2.0),
  photo_urls jsonb DEFAULT '[]'::jsonb,
  bag_count integer DEFAULT 1 CHECK (bag_count > 0 AND bag_count <= 100),
  qr_code text,
  barcode text,
  service_category_code character varying,
  workflow_template_id uuid,
  current_status text,
  current_stage text,
  parent_order_id uuid,
  order_subtype text,
  has_split boolean DEFAULT false,
  is_rejected boolean DEFAULT false,
  rejected_from_stage text,
  issue_id uuid,
  has_issue boolean DEFAULT false,
  ready_by_at_new timestamp with time zone,
  last_transition_at timestamp with time zone,
  last_transition_by uuid,
  is_order_quick_drop boolean DEFAULT false,
  quick_drop_quantity integer,
  rack_location character varying,
  CONSTRAINT org_orders_mst_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_order_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_org_order_branch FOREIGN KEY (tenant_org_id) REFERENCES public.org_branches_mst(id),
  CONSTRAINT fk_org_order_branch FOREIGN KEY (branch_id) REFERENCES public.org_branches_mst(id),
  CONSTRAINT fk_org_order_branch FOREIGN KEY (tenant_org_id) REFERENCES public.org_branches_mst(tenant_org_id),
  CONSTRAINT fk_org_order_branch FOREIGN KEY (branch_id) REFERENCES public.org_branches_mst(tenant_org_id),
  CONSTRAINT fk_org_order_type FOREIGN KEY (order_type_id) REFERENCES public.sys_order_type_cd(order_type_id),
  CONSTRAINT fk_org_order_customer FOREIGN KEY (customer_id) REFERENCES public.org_customers_mst(id),
  CONSTRAINT org_orders_mst_workflow_template_id_fkey FOREIGN KEY (workflow_template_id) REFERENCES public.sys_workflow_template_cd(template_id),
  CONSTRAINT fk_order_parent_order FOREIGN KEY (parent_order_id) REFERENCES public.org_orders_mst(id)
);
CREATE TABLE public.org_payments_dtl_tr (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invoice_id uuid NOT NULL,
  tenant_org_id uuid NOT NULL,
  paid_amount numeric DEFAULT 0,
  status text DEFAULT 'pending'::text,
  due_date date,
  payment_method character varying,
  paid_at timestamp without time zone,
  paid_by character varying,
  gateway text,
  transaction_id text,
  metadata jsonb,
  rec_notes character varying,
  created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  CONSTRAINT org_payments_dtl_tr_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_payment_invoice FOREIGN KEY (invoice_id) REFERENCES public.org_invoice_mst(id),
  CONSTRAINT fk_org_payment_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_price_list_items_dtl (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  price_list_id uuid NOT NULL,
  product_id uuid NOT NULL,
  price numeric NOT NULL CHECK (price >= 0::numeric),
  discount_percent numeric DEFAULT 0 CHECK (discount_percent >= 0::numeric AND discount_percent <= 100::numeric),
  min_quantity integer DEFAULT 1,
  max_quantity integer,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  is_active boolean NOT NULL DEFAULT true,
  CONSTRAINT org_price_list_items_dtl_pkey PRIMARY KEY (id),
  CONSTRAINT org_price_list_items_dtl_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT org_price_list_items_dtl_price_list_id_fkey FOREIGN KEY (price_list_id) REFERENCES public.org_price_lists_mst(id),
  CONSTRAINT org_price_list_items_dtl_tenant_org_id_product_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_product_data_mst(id),
  CONSTRAINT org_price_list_items_dtl_tenant_org_id_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.org_product_data_mst(id),
  CONSTRAINT org_price_list_items_dtl_tenant_org_id_product_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_product_data_mst(tenant_org_id),
  CONSTRAINT org_price_list_items_dtl_tenant_org_id_product_id_fkey FOREIGN KEY (product_id) REFERENCES public.org_product_data_mst(tenant_org_id)
);
CREATE TABLE public.org_price_lists_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  name character varying NOT NULL,
  name2 character varying,
  description text,
  description2 text,
  price_list_type character varying NOT NULL CHECK (price_list_type::text = ANY (ARRAY['standard'::character varying, 'express'::character varying, 'vip'::character varying, 'seasonal'::character varying, 'b2b'::character varying, 'promotional'::character varying]::text[])),
  effective_from date,
  effective_to date,
  is_default boolean DEFAULT false,
  priority integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  rec_order integer,
  rec_notes character varying,
  is_active boolean NOT NULL DEFAULT true,
  CONSTRAINT org_price_lists_mst_pkey PRIMARY KEY (id),
  CONSTRAINT org_price_lists_mst_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_product_data_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  service_category_code text,
  product_code text NOT NULL,
  product_name text,
  product_name2 text,
  hint_text text,
  is_retail_item boolean DEFAULT false,
  product_group1 text,
  product_group2 text,
  product_group3 text,
  product_type integer,
  price_type text,
  product_unit character varying,
  default_sell_price numeric,
  default_express_sell_price numeric,
  product_cost numeric,
  min_sell_price numeric,
  min_quantity integer,
  pieces_per_product integer,
  extra_days integer,
  turnaround_hh numeric,
  turnaround_hh_express numeric,
  multiplier_express numeric,
  product_order integer,
  is_tax_exempt integer,
  tags json,
  id_sku text,
  is_active boolean NOT NULL DEFAULT true,
  product_color1 text,
  product_color2 text,
  product_color3 text,
  product_icon text,
  product_image text,
  rec_order integer,
  rec_notes text,
  rec_status smallint DEFAULT 1,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by text,
  created_info text,
  updated_at timestamp without time zone,
  updated_by text,
  updated_info text,
  CONSTRAINT org_product_data_mst_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_prod_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_org_prod_ctg FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_org_prod_ctg FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_org_prod_ctg FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(service_category_code),
  CONSTRAINT fk_org_prod_ctg FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(service_category_code)
);
CREATE TABLE public.org_promo_codes_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  promo_code character varying NOT NULL,
  promo_name character varying,
  promo_name2 character varying,
  description text,
  description2 text,
  discount_type character varying NOT NULL CHECK (discount_type::text = ANY (ARRAY['percentage'::character varying, 'fixed_amount'::character varying]::text[])),
  discount_value numeric NOT NULL CHECK (discount_value > 0::numeric),
  max_discount_amount numeric,
  min_order_amount numeric DEFAULT 0,
  max_order_amount numeric,
  applicable_categories jsonb,
  max_uses integer,
  max_uses_per_customer integer DEFAULT 1,
  current_uses integer DEFAULT 0,
  valid_from timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  valid_to timestamp with time zone,
  is_active boolean NOT NULL DEFAULT true,
  is_enabled boolean NOT NULL DEFAULT true,
  metadata jsonb,
  created_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp with time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  rec_order integer,
  rec_notes character varying,
  CONSTRAINT org_promo_codes_mst_pkey PRIMARY KEY (id),
  CONSTRAINT org_promo_codes_tenant_fk FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_promo_usage_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  promo_code_id uuid NOT NULL,
  customer_id uuid,
  order_id uuid,
  invoice_id uuid,
  discount_amount numeric NOT NULL,
  order_total_before numeric NOT NULL,
  order_total_after numeric NOT NULL,
  used_at timestamp with time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  used_by character varying,
  metadata jsonb,
  CONSTRAINT org_promo_usage_log_pkey PRIMARY KEY (id),
  CONSTRAINT org_promo_usage_tenant_fk FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT org_promo_usage_promo_fk FOREIGN KEY (promo_code_id) REFERENCES public.org_promo_codes_mst(id)
);
CREATE TABLE public.org_service_category_cf (
  tenant_org_id uuid NOT NULL,
  service_category_code character varying NOT NULL,
  is_enabled boolean DEFAULT true,
  is_active boolean DEFAULT true,
  rec_order integer DEFAULT 1,
  rec_notes text,
  rec_status smallint DEFAULT 1,
  created_at timestamp without time zone NOT NULL DEFAULT CURRENT_TIMESTAMP,
  created_by text,
  created_info text,
  updated_at timestamp without time zone,
  updated_by text,
  updated_info text,
  CONSTRAINT org_service_category_cf_pkey PRIMARY KEY (service_category_code, tenant_org_id),
  CONSTRAINT fk_org_ctg_sys FOREIGN KEY (service_category_code) REFERENCES public.sys_service_category_cd(service_category_code),
  CONSTRAINT fk_org_ctg_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_subscriptions_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  plan character varying DEFAULT 'free'::character varying,
  status character varying DEFAULT 'trial'::character varying,
  orders_limit integer DEFAULT 20,
  orders_used integer DEFAULT 0,
  branch_limit integer DEFAULT 1,
  user_limit integer DEFAULT 2,
  start_date timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  end_date timestamp without time zone NOT NULL,
  trial_ends timestamp without time zone,
  last_payment_date timestamp without time zone,
  last_payment_amount numeric,
  last_payment_method character varying,
  payment_reference character varying,
  payment_notes text,
  last_invoice_number character varying,
  last_invoice_date timestamp without time zone,
  is_active boolean DEFAULT true,
  is_enabled boolean DEFAULT true,
  rec_status smallint DEFAULT 1,
  rec_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by text,
  created_info text,
  updated_at timestamp without time zone,
  updated_by text,
  updated_info text,
  auto_renew boolean DEFAULT true,
  cancellation_date timestamp without time zone,
  cancellation_reason text,
  CONSTRAINT org_subscriptions_mst_pkey PRIMARY KEY (id),
  CONSTRAINT fk_org_subs_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_tenant_service_category_workflow_cf (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  service_category_code character varying NOT NULL,
  workflow_template_id uuid,
  use_preparation_screen boolean,
  use_assembly_screen boolean,
  use_qa_screen boolean,
  track_individual_piece boolean,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT org_tenant_service_category_workflow_cf_pkey PRIMARY KEY (id),
  CONSTRAINT org_tenant_service_category_workflow__workflow_template_id_fkey FOREIGN KEY (workflow_template_id) REFERENCES public.sys_workflow_template_cd(template_id),
  CONSTRAINT fk_service_category_workflow_category FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_service_category_workflow_category FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_service_category_workflow_category FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(service_category_code),
  CONSTRAINT fk_service_category_workflow_category FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(service_category_code)
);
CREATE TABLE public.org_tenant_settings_cf (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  setting_code text NOT NULL,
  setting_name text,
  setting_name2 text,
  setting_desc text,
  setting_value_type text CHECK (setting_value_type = ANY (ARRAY['BOOLEAN'::text, 'TEXT'::text, 'NUMBER'::text, 'DATE'::text])),
  setting_value text,
  is_active boolean NOT NULL DEFAULT true,
  branch_id uuid,
  user_id uuid,
  rec_order integer,
  rec_notes text,
  rec_status smallint DEFAULT 1,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by text,
  created_info text,
  updated_at timestamp with time zone,
  updated_by text,
  updated_info text,
  CONSTRAINT org_tenant_settings_cf_pkey PRIMARY KEY (id),
  CONSTRAINT fk_ots_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_tenant_workflow_settings_cf (
  tenant_org_id uuid NOT NULL,
  use_preparation_screen boolean DEFAULT false,
  use_assembly_screen boolean DEFAULT false,
  use_qa_screen boolean DEFAULT false,
  track_individual_piece boolean DEFAULT false,
  orders_split_enabled boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT org_tenant_workflow_settings_cf_pkey PRIMARY KEY (tenant_org_id),
  CONSTRAINT org_tenant_workflow_settings_cf_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_tenant_workflow_templates_cf (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  template_id uuid NOT NULL,
  is_default boolean DEFAULT false,
  allow_back_steps boolean DEFAULT false,
  extra_config jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  CONSTRAINT org_tenant_workflow_templates_cf_pkey PRIMARY KEY (id),
  CONSTRAINT org_tenant_workflow_templates_cf_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.sys_workflow_template_cd(template_id),
  CONSTRAINT fk_tenant_workflow_templates_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_tenants_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  name2 character varying,
  slug character varying NOT NULL UNIQUE,
  email character varying NOT NULL UNIQUE,
  phone character varying NOT NULL,
  s_cureent_plan character varying DEFAULT 'plan_freemium'::character varying,
  address text,
  city character varying,
  country character varying DEFAULT 'OM'::character varying,
  currency character varying DEFAULT 'OMR'::character varying,
  timezone character varying DEFAULT 'Asia/Muscat'::character varying,
  language character varying DEFAULT 'en'::character varying,
  is_active boolean DEFAULT true,
  status character varying DEFAULT 'trial'::character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  logo_url character varying,
  brand_color_primary character varying DEFAULT '#3B82F6'::character varying,
  brand_color_secondary character varying DEFAULT '#10B981'::character varying,
  business_hours jsonb DEFAULT '{"fri": {"open": "08:00", "close": "18:00"}, "mon": {"open": "08:00", "close": "18:00"}, "sat": {"open": "09:00", "close": "14:00"}, "sun": null, "thu": {"open": "08:00", "close": "18:00"}, "tue": {"open": "08:00", "close": "18:00"}, "wed": {"open": "08:00", "close": "18:00"}}'::jsonb,
  feature_flags jsonb DEFAULT '{"printing": false, "api_access": false, "driver_app": false, "white_label": false, "multi_branch": false, "pdf_invoices": false, "b2b_contracts": false, "in_app_receipts": false, "loyalty_programs": false, "whatsapp_receipts": true, "advanced_analytics": false, "marketplace_listings": false}'::jsonb,
  CONSTRAINT org_tenants_mst_pkey PRIMARY KEY (id)
);
CREATE TABLE public.org_usage_tracking (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  period_start date NOT NULL,
  period_end date NOT NULL,
  orders_count integer DEFAULT 0,
  users_count integer DEFAULT 0,
  branches_count integer DEFAULT 0,
  storage_mb numeric DEFAULT 0,
  api_calls integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT org_usage_tracking_pkey PRIMARY KEY (id),
  CONSTRAINT org_usage_tracking_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_users_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  tenant_org_id uuid NOT NULL,
  display_name character varying,
  role character varying NOT NULL DEFAULT 'viewer'::character varying CHECK (role::text = ANY (ARRAY['admin'::character varying, 'operator'::character varying, 'viewer'::character varying]::text[])),
  is_active boolean NOT NULL DEFAULT true,
  last_login_at timestamp without time zone,
  login_count integer DEFAULT 0,
  preferences jsonb DEFAULT '{}'::jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  created_by character varying,
  created_info text,
  updated_at timestamp without time zone,
  updated_by character varying,
  updated_info text,
  rec_status smallint DEFAULT 1,
  rec_notes character varying,
  failed_login_attempts integer DEFAULT 0,
  last_failed_login_at timestamp without time zone,
  locked_until timestamp without time zone,
  lock_reason character varying,
  CONSTRAINT org_users_mst_pkey PRIMARY KEY (id),
  CONSTRAINT org_users_mst_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT org_users_mst_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_workflow_rules (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  from_status character varying NOT NULL,
  to_status character varying NOT NULL,
  is_allowed boolean DEFAULT true,
  requires_role character varying,
  validation_rules jsonb DEFAULT '{}'::jsonb,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  CONSTRAINT org_workflow_rules_pkey PRIMARY KEY (id),
  CONSTRAINT fk_workflow_rules_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.org_workflow_settings_cf (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  tenant_org_id uuid NOT NULL,
  service_category_code character varying,
  workflow_steps jsonb NOT NULL DEFAULT '["DRAFT", "INTAKE", "PREPARATION", "SORTING", "WASHING", "DRYING", "FINISHING", "ASSEMBLY", "QA", "PACKING", "READY", "OUT_FOR_DELIVERY", "DELIVERED", "CLOSED"]'::jsonb,
  status_transitions jsonb NOT NULL DEFAULT '{}'::jsonb,
  quality_gate_rules jsonb DEFAULT '{}'::jsonb,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  created_by uuid,
  updated_by uuid,
  CONSTRAINT org_workflow_settings_cf_pkey PRIMARY KEY (id),
  CONSTRAINT fk_workflow_settings_tenant FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id),
  CONSTRAINT fk_workflow_settings_category FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_workflow_settings_category FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(tenant_org_id),
  CONSTRAINT fk_workflow_settings_category FOREIGN KEY (tenant_org_id) REFERENCES public.org_service_category_cf(service_category_code),
  CONSTRAINT fk_workflow_settings_category FOREIGN KEY (service_category_code) REFERENCES public.org_service_category_cf(service_category_code)
);
CREATE TABLE public.sys_audit_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid,
  tenant_org_id uuid,
  action character varying NOT NULL,
  entity_type character varying,
  entity_id uuid,
  old_values jsonb,
  new_values jsonb,
  ip_address inet,
  user_agent text,
  request_id character varying,
  status character varying DEFAULT 'success'::character varying,
  error_message text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sys_audit_log_pkey PRIMARY KEY (id),
  CONSTRAINT sys_audit_log_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT sys_audit_log_tenant_org_id_fkey FOREIGN KEY (tenant_org_id) REFERENCES public.org_tenants_mst(id)
);
CREATE TABLE public.sys_customers_mst (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  customer_source_type text NOT NULL DEFAULT 'DIRECT'::text,
  first_name text,
  last_name text,
  display_name text,
  name text,
  name2 text,
  phone text,
  email text,
  type text DEFAULT 'walk_in'::text,
  address text,
  area text,
  building text,
  floor text,
  preferences jsonb DEFAULT '{}'::jsonb,
  first_tenant_org_id uuid,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  customer_number character varying,
  profile_status character varying DEFAULT 'guest'::character varying,
  phone_verified boolean DEFAULT false,
  email_verified boolean DEFAULT false,
  avatar_url character varying,
  CONSTRAINT sys_customers_mst_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sys_order_type_cd (
  order_type_id character varying NOT NULL,
  order_type_name character varying,
  order_type_name2 character varying,
  is_active boolean NOT NULL DEFAULT true,
  rec_notes character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  order_type_color1 character varying,
  order_type_color2 character varying,
  order_type_color3 character varying,
  order_type_icon character varying,
  order_type_image character varying,
  CONSTRAINT sys_order_type_cd_pkey PRIMARY KEY (order_type_id)
);
CREATE TABLE public.sys_otp_codes (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  phone character varying NOT NULL,
  code character varying NOT NULL,
  purpose character varying NOT NULL,
  expires_at timestamp without time zone NOT NULL,
  verified_at timestamp without time zone,
  attempts integer DEFAULT 0,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sys_otp_codes_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sys_payment_method_cd (
  payment_method_code text NOT NULL,
  payment_method_name text,
  payment_method_name2 text,
  is_enabled boolean NOT NULL DEFAULT true,
  is_active boolean NOT NULL DEFAULT true,
  rec_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  payment_type_color1 text,
  payment_type_color2 text,
  payment_type_color3 text,
  payment_type_icon text,
  payment_type_image text,
  CONSTRAINT sys_payment_method_cd_pkey PRIMARY KEY (payment_method_code)
);
CREATE TABLE public.sys_payment_type_cd (
  payment_type_id text NOT NULL,
  payment_type_name text,
  payment_type_name2 text,
  is_enabled boolean NOT NULL DEFAULT false,
  has_plan boolean NOT NULL DEFAULT false,
  is_active boolean NOT NULL DEFAULT true,
  rec_notes text,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  payment_type_color1 text,
  payment_type_color2 text,
  payment_type_color3 text,
  payment_type_icon text,
  payment_type_image text,
  CONSTRAINT sys_payment_type_cd_pkey PRIMARY KEY (payment_type_id)
);
CREATE TABLE public.sys_plan_limits (
  plan_code character varying NOT NULL,
  plan_name character varying NOT NULL,
  plan_name2 character varying,
  plan_description text,
  plan_description2 text,
  orders_limit integer NOT NULL,
  users_limit integer NOT NULL,
  branches_limit integer NOT NULL,
  storage_mb_limit integer NOT NULL,
  price_monthly numeric NOT NULL,
  price_yearly numeric,
  feature_flags jsonb NOT NULL,
  is_public boolean DEFAULT true,
  display_order integer,
  is_active boolean DEFAULT true,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  CONSTRAINT sys_plan_limits_pkey PRIMARY KEY (plan_code)
);
CREATE TABLE public.sys_service_category_cd (
  service_category_code character varying NOT NULL,
  ctg_name character varying NOT NULL,
  ctg_name2 character varying,
  ctg_desc character varying,
  turnaround_hh numeric,
  turnaround_hh_express numeric,
  multiplier_express numeric,
  is_builtin boolean NOT NULL DEFAULT false,
  has_fee boolean NOT NULL DEFAULT false,
  is_mandatory boolean NOT NULL DEFAULT false,
  is_active boolean NOT NULL DEFAULT true,
  rec_order integer DEFAULT 1,
  rec_status smallint DEFAULT 1,
  rec_notes character varying,
  created_at timestamp without time zone DEFAULT CURRENT_TIMESTAMP,
  updated_at timestamp without time zone,
  service_category_color1 character varying,
  service_category_color2 character varying,
  service_category_color3 character varying,
  service_category_icon character varying,
  service_category_image character varying,
  CONSTRAINT sys_service_category_cd_pkey PRIMARY KEY (service_category_code)
);
CREATE TABLE public.sys_tenant_settings_cd (
  setting_code text NOT NULL,
  setting_name text,
  setting_name2 text,
  setting_desc text,
  setting_value_type text CHECK (setting_value_type = ANY (ARRAY['BOOLEAN'::text, 'TEXT'::text, 'NUMBER'::text, 'DATE'::text])),
  setting_value text,
  is_for_tenants_org boolean NOT NULL DEFAULT true,
  is_active boolean NOT NULL DEFAULT true,
  is_per_tenant_org_id boolean NOT NULL DEFAULT true,
  is_per_branch_id boolean NOT NULL DEFAULT false,
  is_per_user_id boolean NOT NULL DEFAULT false,
  rec_order integer,
  rec_notes text,
  rec_status smallint DEFAULT 1,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  created_by text,
  created_info text,
  updated_at timestamp with time zone,
  updated_by text,
  updated_info text,
  CONSTRAINT sys_tenant_settings_cd_pkey PRIMARY KEY (setting_code)
);
CREATE TABLE public.sys_workflow_template_cd (
  template_id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_code character varying NOT NULL UNIQUE,
  template_name character varying NOT NULL,
  template_name2 character varying,
  template_desc text,
  is_active boolean NOT NULL DEFAULT true,
  rec_order integer DEFAULT 0,
  rec_status smallint DEFAULT 1,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  CONSTRAINT sys_workflow_template_cd_pkey PRIMARY KEY (template_id)
);
CREATE TABLE public.sys_workflow_template_stages (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_id uuid NOT NULL,
  stage_code character varying NOT NULL,
  stage_name character varying NOT NULL,
  stage_name2 character varying,
  stage_type character varying NOT NULL,
  seq_no integer NOT NULL,
  is_terminal boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  CONSTRAINT sys_workflow_template_stages_pkey PRIMARY KEY (id),
  CONSTRAINT sys_workflow_template_stages_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.sys_workflow_template_cd(template_id)
);
CREATE TABLE public.sys_workflow_template_transitions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_id uuid NOT NULL,
  from_stage_code character varying NOT NULL,
  to_stage_code character varying NOT NULL,
  requires_scan_ok boolean DEFAULT false,
  requires_invoice boolean DEFAULT false,
  requires_pod boolean DEFAULT false,
  allow_manual boolean DEFAULT true,
  auto_when_done boolean DEFAULT false,
  is_active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone,
  CONSTRAINT sys_workflow_template_transitions_pkey PRIMARY KEY (id),
  CONSTRAINT sys_workflow_template_transitions_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.sys_workflow_template_cd(template_id)
);